<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario Kart Typing Race!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: linear-gradient(to bottom, #87CEEB 0%, #98D98E 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #E60012;
            text-shadow: 3px 3px 0px #FFD700;
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .cup-display {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 20px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 15px;
            border: 4px solid #FF8C00;
            position: relative;
            overflow: hidden;
            transition: background 0.5s ease;
        }

        /* All cups use the same flower cup gradient */
        .cup-display.mushroom,
        .cup-display.flower,
        .cup-display.leaf,
        .cup-display.star {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-color: #FF8C00;
        }

        .cup-display::before {
            content: attr(data-icon);
            position: absolute;
            top: 0;
            left: -1000px;
            right: 0;
            bottom: 0;
            font-size: 2em;
            line-height: 1.5em;
            opacity: 0.3;
            pointer-events: none;
            z-index: 0;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            overflow: show;
            transform: rotate(-45deg);
        }

        .cup-name {
            font-size: 1.5em;
            color: #8B4513;
            position: relative;
            z-index: 1;
        }

        .cup-icon {
            display: none;
        }

        .race-track {
            background: #333;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            min-height: 200px;
        }

        .track-lines {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: repeating-linear-gradient(
                to right,
                white 0px,
                white 30px,
                transparent 30px,
                transparent 60px
            );
        }

        .racer {
            position: relative;
            transition: margin-left 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .racer img {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }

        .mario-racer {
            display: flex;
            align-items: center;
            transition: margin-left 0.4s linear;
            will-change: transform;
            transform: translateZ(0);
        }
        
        .bowser-racer {
            display: flex;
            align-items: center;
            transition: margin-left 60s linear;
        }

        .target-letter {
            text-align: center;
            font-size: 1.5em;
            line-height: 3em;
            color: #E60012;
            background: #FFD700;
            padding: 10px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 5px solid #FF8C00;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2);
        }

        .keyboard-guide {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            margin-bottom: 30px;
        }

        .keyboard-row {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .key {
            background: linear-gradient(145deg, #f0f0f0, #d0d0d0);
            border: 3px solid #999;
            border-radius: 8px;
            padding: 15px 20px;
            font-size: 1.2em;
            color: #333;
            box-shadow: 0 4px 0 #888;
            min-width: 50px;
            text-align: center;
            opacity: 0.3;
        }

        .key.in-cup {
            opacity: 1;
        }

        .key.active {
            background: linear-gradient(145deg, #4ade80, #22c55e);
            border-color: #16a34a;
            color: white;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #15803d;
        }



        .message {
            text-align: center;
            font-size: 1.2em;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: #D1FAE5;
            color: #065F46;
            border: 3px solid #10B981;
            display: block;
        }

        .message.level-up {
            background: #FEF3C7;
            color: #92400E;
            border: 3px solid #F59E0B;
            display: block;
            font-size: 1em;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .bounce {
            animation: bounce 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake {
            animation: shake 0.3s;
        }

        .cup-unlock {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .cup-unlock-content {
            text-align: center;
            color: white;
            padding: 40px;
        }

        .cup-unlock-content h2 {
            font-size: 2em;
            color: #FFD700;
            margin-bottom: 30px;
            animation: pulse 1s infinite;
        }

        .cup-unlock-icon {
            font-size: 5em;
            margin: 20px 0;
            animation: bounce 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .stars {
            font-size: 2em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üèÅ MARIO KART TYPING RACE! üèÅ</h1>
        
        <div class="cup-display">
            <div class="cup-name" id="cupName">MUSHROOM CUP</div>
            <div class="cup-icon" id="cupIcon">üçÑ</div>
        </div>

        <div class="message" id="message"></div>

        <div class="race-track">
            <div class="track-lines"></div>
            <div class="racer" id="racer">
                <div class="mario-racer" id="marioRacer">
                    <img src="sprites/mario-kart.png" alt="Mario">
                </div>
                <div class="bowser-racer" id="bowserRacer">
                    <img src="sprites/bowser-walking.gif" alt="Bowser">
                </div>
            </div>
        </div>

        <div class="target-letter" id="targetLetter">Press any key to start!</div>

        <div class="keyboard-guide">
        </div>
    </div>

    <div class="cup-unlock" id="cupUnlock">
        <div class="cup-unlock-content">
            <h2>üéâ NEW CUP UNLOCKED! üéâ</h2>
            <div class="cup-unlock-icon" id="unlockIcon">üî•</div>
            <p id="unlockMessage" style="font-size: 1.2em; margin-top: 20px;"></p>
            <div class="stars">‚≠ê‚≠ê‚≠ê</div>
        </div>
    </div>

    <script>
        const letterSets = {
            0: ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'], // Mushroom - home row
            1: ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'], // Flower - top row
            2: ['z', 'x', 'c', 'v', 'b', 'n', 'm'], // Leaf - bottom row
            3: ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', 'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', 'z', 'x', 'c', 'v', 'b', 'n', 'm'] // Star - all rows
        };
        
        let targetLetters = letterSets[0];
        let currentLetter = '';
        let totalTyped = 0;
        let correctCount = 0;
        let currentCup = 0;
        let cupProgress = 0;
        let gameStarted = false;
        let bowserInterval = null;
        let raceStartTime = null;

        const cups = [
            { name: 'MUSHROOM CUP', icon: 'üçÑ', required: 20, theme: 'mushroom' },
            { name: 'FLOWER CUP', icon: 'üå∏', required: 20, theme: 'flower' },
            { name: 'LEAF CUP', icon: 'üçÉ', required: 20, theme: 'leaf' },
            { name: 'STAR CUP', icon: '‚≠ê', required: 20, theme: 'star' }
        ];

        function generateNewLetter() {
            // Create a copy of the target letters
            let availableLetters = [...targetLetters];
            
            // Remove the current letter if it exists
            if (currentLetter) {
                availableLetters = availableLetters.filter(letter => letter !== currentLetter);
            }
            
            // Select a random letter from the remaining ones
            currentLetter = availableLetters[Math.floor(Math.random() * availableLetters.length)];
            document.getElementById('targetLetter').textContent = currentLetter.toUpperCase();
            
            // Highlight the key
            document.querySelectorAll('.key').forEach(key => {
                key.classList.remove('active');
            });
            const targetKey = document.querySelector(`[data-key="${currentLetter}"]`);
            if (targetKey) {
                targetKey.classList.add('active');
            }
        }
        
        function updateKeyboardDisplay() {
            const keyboardGuide = document.querySelector('.keyboard-guide');
            keyboardGuide.innerHTML = '';
            
            const allRows = [
                ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
                ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
                ['z', 'x', 'c', 'v', 'b', 'n', 'm']
            ];
            
            allRows.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'keyboard-row';
                
                row.forEach(letter => {
                    const keyDiv = document.createElement('div');
                    keyDiv.className = 'key';
                    keyDiv.setAttribute('data-key', letter);
                    keyDiv.textContent = letter.toUpperCase();
                    
                    // Highlight keys that are in the current cup's letter set
                    if (targetLetters.includes(letter)) {
                        keyDiv.classList.add('in-cup');
                    }
                    
                    rowDiv.appendChild(keyDiv);
                });
                
                keyboardGuide.appendChild(rowDiv);
            });
        }

        function updateStats() {
            // Stats removed - function kept for compatibility
        }

        function updateProgress() {
            // Progress bar removed - function kept for compatibility
        }

        function moveRacer() {
            const cup = cups[currentCup];
            const progress = (cupProgress / cup.required) * 100;
            const marioRacer = document.getElementById('marioRacer');
            marioRacer.style.marginLeft = `${progress * 0.8}%`;
        }

        function startBowserRace() {
            raceStartTime = Date.now();
            const bowserRacer = document.getElementById('bowserRacer');
            bowserRacer.style.marginLeft = '0%';
            
            // Force reflow
            void bowserRacer.offsetWidth;
            
            // Start Bowser's 60 second journey
            bowserRacer.style.marginLeft = '80%';
            
            // Check if Bowser wins
            bowserInterval = setTimeout(() => {
                if (cupProgress < cups[currentCup].required) {
                    gameLose();
                }
            }, 60000);
        }

        function resetBowserRace() {
            if (bowserInterval) {
                clearTimeout(bowserInterval);
            }
            const bowserRacer = document.getElementById('bowserRacer');
            bowserRacer.style.transition = 'none';
            bowserRacer.style.marginLeft = '0%';
            
            // Force reflow
            void bowserRacer.offsetWidth;
            
            bowserRacer.style.transition = 'margin-left 60s linear';
        }

        function gameLose() {
            gameOver = true;
            const overlay = document.getElementById('cupUnlock');
            const victoryContent = overlay.querySelector('.cup-unlock-content');
            
            victoryContent.innerHTML = `
                <h2>üò¢ BOWSER WINS! üò¢</h2>
                <div class="cup-unlock-icon">üê¢</div>
                <p style="font-size: 1.2em; margin-top: 20px;">Try again and type faster!</p>
            `;
            
            overlay.style.display = 'flex';
            
            setTimeout(() => {
                location.reload();
            }, 5000);
        }

        function unlockNextCup() {
            // Stop Bowser's race
            if (bowserInterval) {
                clearTimeout(bowserInterval);
            }
            
            if (currentCup < cups.length - 1) {
                currentCup++;
                cupProgress = 0;
                
                // Update letter set for new cup
                targetLetters = letterSets[currentCup];
                
                const overlay = document.getElementById('cupUnlock');
                const cup = cups[currentCup];
                gameStarted = true;
                document.getElementById('message').textContent = '';
                document.getElementById('targetLetter').style.fontSize = '3em';
                document.getElementById('targetLetter').style.lineHeight = '1.5em';
                document.getElementById('unlockIcon').textContent = cup.icon;
                document.getElementById('unlockMessage').textContent = `You unlocked the ${cup.name}!`;
                
                overlay.style.display = 'flex';
                
                setTimeout(() => {
                    overlay.style.display = 'none';
                    updateCupDisplay();
                    updateKeyboardDisplay();
                    updateProgress();
                    
                    // Reset Mario racer
                    const marioRacer = document.getElementById('marioRacer');
                    marioRacer.style.transition = 'none';
                    marioRacer.style.marginLeft = '0%';
                    // Force reflow to apply the instant position change
                    void marioRacer.offsetHeight;
                    marioRacer.style.transition = 'margin-left 0.4s linear';
                    resetBowserRace();
                    startBowserRace();
                    
                    generateNewLetter();
                }, 3000);
            } else {
                // Completed all cups!
                const overlay = document.getElementById('cupUnlock');
                const victoryContent = overlay.querySelector('.cup-unlock-content');
                
                victoryContent.innerHTML = `
                    <h2>üéâ CONGRATS, YOU'RE #1! üéâ</h2>
                    <div class="cup-unlock-icon">üèÜ</div>
                    <p style="font-size: 1.2em; margin-top: 20px;">YOU ARE A TYPING CHAMPION!</p>
                    <div class="stars">‚≠ê‚≠ê‚≠ê</div>
                `;
                
                overlay.style.display = 'flex';
                
                setTimeout(() => {
                    location.reload();
                }, 10000);
            }
        }

        function updateCupDisplay() {
            const cup = cups[currentCup];
            const cupDisplay = document.querySelector('.cup-display');
            document.getElementById('cupName').textContent = cup.name;
            
            // Update theme class
            cupDisplay.className = 'cup-display ' + cup.theme;
            
            // Create tiled background pattern
            let pattern = '';
            for (let i = 0; i < 500; i++) {
                pattern += cup.icon + ' ';
            }
            cupDisplay.setAttribute('data-icon', pattern);
        }

        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            
            if (!gameStarted) {
                gameStarted = true;
                document.getElementById('targetLetter').style.fontSize = '3em';
                document.getElementById('targetLetter').style.lineHeight = '1.5em';
                generateNewLetter();
                startBowserRace();
                return;
            }
            
            if (!targetLetters.includes(key)) {
                return;
            }
            
            totalTyped++;
            
            if (key === currentLetter) {
                correctCount++;
                cupProgress++;
                
                updateProgress();
                moveRacer();
                
                // Check if cup completed
                if (cupProgress >= cups[currentCup].required) {
                    unlockNextCup();
                }
                
                generateNewLetter();
            } else {
                document.getElementById('targetLetter').classList.add('shake');
                setTimeout(() => {
                    document.getElementById('targetLetter').classList.remove('shake');
                }, 300);
            }
            
            updateStats();
        });

        // Initialize
        updateCupDisplay();
        updateKeyboardDisplay();
    </script>
</body>
</html>